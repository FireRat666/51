<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Card Formatter</title>
  <link rel="stylesheet" href="https://firer.at/pages/style.css" />
  <script src="https://firer.at/scripts/RandomBG.js"></script>
</head>
<body id="body">
  <br><b><a href="https://cast.clrtd.com/api">CrCast</a> to Holograms Against Humanity Card Formatter</b><br><br>
  <form id="formatterForm">
    <label for="inputText">Enter JSON:</label><br>
    <textarea id="inputText" class="url-form url-thing" style="font-size: 15px;" rows="10" cols="40" placeholder='Enter the card JSON here'></textarea><br>
    <button type="button" class="url-thing" onclick="formatCards()">Format</button>
  </form><br>

  <b>Formatted Output</b>
  <textarea id="outputText" class="url-form url-thing" style="font-size: 15px;" rows="15" cols="40" readonly></textarea>

  <script>
    function escapeQuotes(text) {
      // Escape all double quotes inside the text
      return text.replace(/"/g, '\\"');
    }

    function formatTextWithBlanksAndBreaks(textArray) {
      // Join array segments with the blank "_____"
      let combinedText = textArray.join(' _____ ');
      // Escape internal quotes
      return escapeQuotes(combinedText);
    }

    function formatCards() {
      const inputText = document.getElementById('inputText').value;
      try {
        const data = JSON.parse(inputText);

        // Process black cards
        const formattedBlack = data.calls.map(call =>
          `{"text": "${formatTextWithBlanksAndBreaks(call.text)}"}`
        ).join(',\n');

        // Process white cards
        const formattedWhite = data.responses.map(response =>
          `{"text": "${escapeQuotes(response.text[0])}"}`
        ).join(',\n');

        // Create final JSON structure
        const formattedOutput = `{\n"black": [\n${formattedBlack}\n],\n"white": [\n${formattedWhite}\n]\n}`;
        document.getElementById('outputText').value = formattedOutput;
      } catch (e) {
        alert('Invalid JSON format. Please correct your input.');
      }
    }
  </script>
</body>
</html>
