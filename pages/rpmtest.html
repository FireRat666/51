<!DOCTYPE html>
<html lang="en">
  <head style="background-color:#000000;">
<!--     <script src="./webpagescripts.js"></script> -->
    <link rel="stylesheet" href="/pages/style.css" />
  	<style>
	  </style>
    <meta name="color-scheme" content="dark">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta charset="utf-8">
    <title>Stuff</title>
    <link id="favicon" rel="icon" href="https://firer.at/files/favicon.ico" type="image/x-icon" />
	<!-- Analytics and Cookie Stuff Start -->
	<script src="https://cookiechimp.com/widget/mV3trJ.js"></script>
	<script type="text/plain" data-src="https://www.googletagmanager.com/gtag/js?id=G-HSMS8JERQ2"
	  data-category="analytics" data-service="Google Analytics" ></script>
	<script type="text/plain" data-category="analytics" data-service="Google Analytics" >
	  window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);}
	  gtag('js', new Date()); gtag('config', 'G-HSMS8JERQ2'); </script>
	<!-- Analytics and Cookie Stuff END -->
  </head>
  <body class="fixed bodyc"><div>
    <center>
	<h2><span style="color: #c70278">W</span><span style="color: #2EFF37">e</span><span style="color: #e86c00">l</span><span style="color: #00d6de">c</span><span style="color: #9600ed">o</span><span style="color: #009c08">m</span><span style="color: #d91400">e</span></h2>
	<p>Test Page.</p>

  <input type="button" value="Open Ready Player Me" onClick="displayIframe()" />
  <p id="avatarUrl">Avatar URL:</p>
  <p id="usersID">Users RPM ID:</p>
  <p id="tusersID">Test RPM ID:</p>

  <iframe id="frame" class="frame" allow="camera *; microphone *; clipboard-write" hidden></iframe>

  <script>
      const subdomain = 'fire'; // Replace with your custom subdomain
      const frame = document.getElementById('frame');

      frame.src = `https://${subdomain}.readyplayer.me/avatar?frameApi`;

      window.addEventListener('message', subscribe);
      document.addEventListener('message', subscribe);

      function subscribe(event) {
          const json = parse(event);

          if (json?.source !== 'readyplayerme') {
              return;
          }

          // Susbribe to all events sent from Ready Player Me once frame is ready
          if (json.eventName === 'v1.frame.ready') {
              frame.contentWindow.postMessage(
                  JSON.stringify({
                      target: 'readyplayerme',
                      type: 'subscribe',
                      eventName: 'v1.**'
                  }),
                  '*'
              );
          }

          // Get avatar GLB URL
          if (json.eventName === 'v1.avatar.exported') {
              console.log(`Avatar URL: ${json.data.url}`);
              document.getElementById('avatarUrl').innerHTML = `Avatar URL: ${json.data.url}`;
              let thisthingy01 = JSON.parse(localStorage.getItem('persist:user')).data._id
              document.getElementById('tusersID').innerHTML = `Users RPM ID: ${thisthingy01}`;
              // document.getElementById('frame').hidden = true;
          }

          // Get user id
          if (json.eventName === 'v1.user.set') {
              console.log(`User with id ${json.data.id} set: ${JSON.stringify(json)}`);
              document.getElementById('usersID').innerHTML = `Users RPM ID: ${json.data.id}`;
          }
      }

      function parse(event) {
          try {
              return JSON.parse(event.data);
          } catch (error) {
              return null;
          }
      }

      function displayIframe() {
          document.getElementById('frame').hidden = false;
      }
  </script>

	</center>
	</div>
  </body>
</html>